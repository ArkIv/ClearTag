var port=chrome.runtime.connect(),bgPage=chrome.extension.getBackgroundPage();function getCurrentTabUrl(callback){var queryInfo={active:!0,currentWindow:!0};chrome.tabs.query(queryInfo,tabs=>{var tab,url=tabs[0].url;console.assert("string"==typeof url,"tab.url should be a string"),callback(url)})}function clickButton(){var script='  var u = document.getElementsByClassName("super-banner");  if(u[0])u[0].remove();  u = document.getElementsByClassName("grid-chunk__column-box");  if(u[0])u[0].remove();  u = document.getElementsByClassName("main-controller__adv-bottom");  if(u[0])u[0].remove();    u = document.getElementsByClassName("footer");  if(u[0])u[0].remove();    u = document.getElementsByClassName("header");  if(u[0])u[0].remove();    u = document.getElementsByClassName("globalClass_ET");   if(u[0])u[0].remove();     u = document.getElementsByClassName("recommended-top");  if(u[0])u[0].remove();';chrome.tabs.executeScript({code:script})}function getSavedUrlListEvent(key,callback){chrome.storage.sync.get(key,items=>{callback(chrome.runtime.lastError?null:items[key])})}function getSavedClassesList(key,callback){chrome.storage.sync.get(key,items=>{callback(chrome.runtime.lastError?null:items[key])})}function getSavedIdList(key,callback){chrome.storage.sync.get(key,items=>{callback(chrome.runtime.lastError?null:items[key])})}function startTab(){var maskList=document.getElementById("maskList"),classList=document.getElementById("classList"),idList=document.getElementById("idList"),jsTriggers,jsTriggers2,jsTriggers3;getSavedUrlListEvent("maskList",savedList=>{if(savedList){var arr=savedList.split(","),index,len;for(index=0,len=arr.length;index<len;++index)maskList.value+=arr[index].trim()+"\n"}}),getSavedClassesList("classList",savedList=>{if(savedList){var arr=savedList.split(","),index,len;for(index=0,len=arr.length;index<len;++index)classList.value+=arr[index].trim()+"\n"}}),getSavedIdList("idList",savedList=>{if(savedList){var arr=savedList.split(","),index,len;for(index=0,len=arr.length;index<len;++index)idList.value+=arr[index].trim()+"\n"}}),document.querySelectorAll(".js-tab-trigger").forEach(function(trigger){trigger.addEventListener("click",function(){var id=this.getAttribute("data-tab"),content=document.querySelector('.js-tab-content[data-tab="'+id+'"]'),activeTrigger=document.querySelector(".js-tab-trigger.active"),activeContent=document.querySelector(".js-tab-content.active");activeTrigger.classList.remove("active"),trigger.classList.add("active"),activeContent.classList.remove("active"),content.classList.add("active")})}),document.querySelectorAll(".js-tab-trigger2").forEach(function(trigger){trigger.addEventListener("click",function(){var id=this.getAttribute("data-tab"),content=document.querySelector('.js-tab-content2[data-tab="'+id+'"]'),activeTrigger=document.querySelector(".js-tab-trigger2.active"),activeContent=document.querySelector(".js-tab-content2.active");activeTrigger.classList.remove("active"),trigger.classList.add("active"),activeContent.classList.remove("active"),content.classList.add("active")})}),document.querySelectorAll(".js-tab-trigger3").forEach(function(trigger){trigger.addEventListener("click",function(){var id=this.getAttribute("data-tab"),content=document.querySelector('.js-tab-content3[data-tab="'+id+'"]'),activeTrigger=document.querySelector(".js-tab-trigger3.active"),activeContent=document.querySelector(".js-tab-content3.active");activeTrigger.classList.remove("active"),trigger.classList.add("active"),activeContent.classList.remove("active"),content.classList.add("active")})});var nabclick=document.querySelector(".js-tab-trigger[data-tab='4']"),event=new Event("click");nabclick.dispatchEvent(event);var nabclick=document.querySelector(".js-tab-trigger3[data-tab='1']"),event=new Event("click");nabclick.dispatchEvent(event);var buttonInsertUrl=document.querySelector(".buttonInsertUrl"),buttonInsertClass=document.querySelector(".buttonInsertClass"),buttonInsertId=document.querySelector(".buttonInsertId");buttonInsertUrl.addEventListener("click",()=>{addSelectUrl()}),buttonInsertClass.addEventListener("click",()=>{addSelectClass()}),buttonInsertId.addEventListener("click",()=>{addSelectId()});var selectUrl=document.querySelector(".selectUrl"),selectClass=document.querySelector(".selectClass"),selectId=document.querySelector(".selectId"),addrCurrent=document.querySelector(".addrCurrent"),tabHeader_1_4=document.getElementById("tabHeader_1_4"),tab2=document.getElementById("tab-2");tab2.style.visibility="hidden";var tab3=document.getElementById("tab-3");tab3.style.visibility="hidden",tabHeader_1_4.addEventListener("click",()=>{isSelectedTab2()});let textOptionUrl=document.querySelector(".textOptionUrl"),textOptionClass=document.querySelector(".textOptionClass"),textOptionId=document.querySelector(".textOptionId");function removeOptionUrl(e){"option"==e.target.nodeName.toLowerCase()&&(addrCurrent.innerHTML="",textOptionUrl.value=e.target.value,e.target.remove(),isSelectedTab2())}function removeOptionClass(e){"option"==e.target.nodeName.toLowerCase()&&(textOptionClass.value=e.target.value,e.target.remove(),saveSelectors(addrCurrent.innerHTML))}function removeOptionId(e){"option"==e.target.nodeName.toLowerCase()&&(textOptionId.value=e.target.value,e.target.remove())}function isSelectedTab2(){""==addrCurrent.innerHTML.trim()?(tab2.style.visibility="hidden",tab3.style.visibility="hidden"):(tab2.style.visibility="visible",tab3.style.visibility="visible")}function addSelectUrl(txt){if(txt=(txt=txt||textOptionUrl.value).toLowerCase().trim(),!isOptionText(selectUrl,txt)){let opt=document.createElement("option");opt.innerHTML=txt,selectUrl.appendChild(opt),sortetSelect(selectUrl)}}function addSelectClass(txt){if(txt=(txt=txt||textOptionClass.value).toLowerCase().trim(),!isOptionText(selectClass,txt)){let opt=document.createElement("option");opt.innerHTML=txt,selectClass.appendChild(opt),sortetSelect(selectClass)}}function addSelectId(txt){if(txt=(txt=txt||textOptionId.value).toLowerCase().trim(),!isOptionText(selectId,txt)){let opt=document.createElement("option");opt.innerHTML=txt,selectId.appendChild(opt),sortetSelect(selectId)}}function sortetSelect(obj){for(nodes=obj.getElementsByTagName("OPTION"),len=nodes.length,sorted=[];nodes[0];)sorted.push(new String(nodes[0].value)),sorted[sorted.length-1].element=nodes[0],obj.removeChild(nodes[0]);sorted=sorted.sort();for(var i=0;i<len;i++)obj.appendChild(sorted[i].element);saveSelectors(addrCurrent.innerHTML)}function getRandomId(){return"_"+Math.random().toString(36).substr(2,9)}function isOptionText(obj,txt){var i;for(i=0;i<obj.options.length;i++)if(txt.toLowerCase()==obj.options[i].text.toLowerCase()||""==txt.trim())return obj.style.backgroundColor="yellow",setTimeout(function(){obj.style.backgroundColor="white"},50),!0}var buttonDelListener,saveAllLists;function getListString(List){var myList=List.value.split("\n"),ListBuf="",index,len;for(index=0,len=myList.length;index<len;++index)""!=myList[index].trim()&&(ListBuf.length>0?ListBuf+=","+myList[index].trim():ListBuf+=myList[index].trim());return ListBuf}function clickSaveRestart(){var maskSaveList={},maskList=document.getElementById("maskList");maskSaveList.maskList=getListString(maskList),""==maskSaveList.maskList&&(maskSaveList.maskList="http://test.com/test.html"),chrome.storage.sync.set(maskSaveList,function(){chrome.runtime.lastError?Log("error: ","error",chrome.runtime.lastError):(Log("Сохранили адреса...","success"),saveClassList())})}function saveClassList(){var maskSaveList={},maskList=document.getElementById("classList");maskSaveList.classList=getListString(maskList),""==maskSaveList.classList&&(maskSaveList.classList="globalClass_ET"),chrome.storage.sync.set(maskSaveList,function(){chrome.runtime.lastError?Log("Ошибка записи списка классов","error",chrome.runtime.lastError):(Log("Сохранили classList...","success"),saveIdList())})}function saveIdList(){var maskSaveList={},maskList=document.getElementById("idList");maskSaveList.idList=getListString(maskList),""==maskSaveList.idList&&(maskSaveList.idList=""),chrome.storage.sync.set(maskSaveList,function(){chrome.runtime.lastError?Log("Ошибка записи списка ID","error",chrome.runtime.lastError):(Log("Сохранили idList...","success"),closePopup())})}function closePopup(){var bgPage;chrome.extension.getBackgroundPage().delListener(),window.close()}function onkeyupClass(e){}function Log(message,color,obj){var bgPage;chrome.extension.getBackgroundPage().Log("[popup] "+message,color,obj),console.log(message,obj)}function catchLastError(){chrome.runtime.lastError?Log("error: ","error",chrome.runtime.lastError):Log("Скрипт загружен...","success")}function saveSelectors(urlStr){""!=urlStr.trim()&&(bgPage.selectors[urlStr]=selectToStr(selectClass),Log("Запись:","info",bgPage.selectors))}function SaveLists(){let listAll={};var saveList={},maskList=document.querySelector(".selectUrl");saveList.listUrl=selectToStr(maskList),""==saveList.listUrl&&(saveList.listUrl="http://test.com/test.html"),listAll["http://"]=saveList,console.log(listAll),console.log(saveList),console.log(unescape(encodeURIComponent(saveList.listUrl)).length),console.log(saveList.listUrl.length),console.log(saveList.listUrl.byteLength()),chrome.storage.sync.set(listAll,function(){chrome.runtime.lastError?Log("error: ","error",chrome.runtime.lastError):Log("Сохранили адреса...2","success")}),localforage.setItem("ClearClassId_Lists",bgPage.selectors).then(function(value){Log("В базу","info",value)}).catch(function(err){Log("Ошибка записи в базу","error",err)})}function selectToStr(Select){let selectStr="";for(let i=0;i<Select.options.length;i++)selectStr+=0==i?Select.options[i].text:","+Select.options[i].text;return selectStr}selectUrl.addEventListener("dblclick",removeOptionUrl),selectClass.addEventListener("dblclick",removeOptionClass),selectId.addEventListener("dblclick",removeOptionId),selectUrl.addEventListener("change",()=>{addrCurrent.innerHTML=selectUrl.options[selectUrl.selectedIndex].value,isSelectedTab2()}),chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){var textOptionUrl;tabs[0]&&(document.querySelector(".textOptionUrl").value=tabs[0].url)}),sortetSelect(selectUrl),document.getElementById("buttonDelListener").addEventListener("click",()=>{clickSaveRestart()}),document.querySelector(".saveAllLists").addEventListener("click",()=>{SaveLists()}),String.prototype.byteLength=function(){for(var str=this,length=str.length,count=0,i=0,ch=0;i<length;i++)(ch=str.charCodeAt(i))<=127?count++:count+=ch<=2047?2:ch<=65535?3:ch<=2097151?4:ch<=67108863?5:6;return count}}chrome.browserAction.setBadgeText({text:"Ура!"}),document.addEventListener("DOMContentLoaded",()=>{var inf;startTab(),document.getElementsByClassName("textInfo")[0].innerHTML=textInfo});