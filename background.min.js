function startBackground(){getList("maskList",savedList=>{var urlList="";if(savedList){var arr=savedList.split(",");Log("прочитали данные:","info",savedList);var urlfind="<all_urls>";savedList&&(urlfind=arr),"urlfind"==savedList&&(urlfind="<all_urls>"),chrome.webRequest.onCompleted.addListener(urlListener,{urls:urlfind},["responseHeaders"])}})}function getList(key,callback){chrome.storage.sync.get(key,items=>{callback(items[key])})}function loadListClasses(key,callback){chrome.storage.sync.get(key,items=>{callback(items[key])})}function urlListener(details){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){if(tabs[0]){var currenttab=tabs[0].url;details.url==currenttab&&loadListClasses("classList",savedList=>{var classBuffer='var ClearClassBuffer = "'+savedList+'";';loadListClasses("idList",savedList=>{var idBuffer;uploadElement(details,classBuffer+('var ClearIdBuffer = "'+savedList+'";'))})})}})}function uploadElement(details,savedList){setTimeout(function(){chrome.tabs.executeScript(details.tabId,{code:savedList},()=>{chrome.runtime.lastError?Log("error: не создать элемент","error",chrome.runtime.lastError):(Log("элемент создан загружен-3","success"),Log("url (на что среагировал):"+details.url,"success"),uploadScript(details))})},5e3)}function uploadScript(details){chrome.tabs.executeScript(details.tabId,{file:"deletetimer.js"},()=>{chrome.runtime.lastError?Log('error: не загрузился скрипт "deletetimer"',"error",chrome.runtime.lastError):Log('скрипт "deletetimer" загружен',"success")})}function catchLastError(){chrome.runtime.lastError?Log("error: ","error",chrome.runtime.lastError):Log("отключить это","success")}function delListener(){chrome.webRequest.onCompleted.removeListener(urlListener),startBackground()}function Log(message,color,obj){if(0!=logEnabled){switch(color=color||"black"){case"success":case"ok":color="Green";break;case"info":color="DodgerBlue";break;case"error":color="Red";break;case"warning":color="Orange";break;default:color=color}if(obj){var objmess=JSON.stringify(obj);console.log("%cClearClassId : %c"+message,"color: blue;font-weight: bold","color:"+color,obj),chrome.tabs.executeScript({code:"console.log('%cClearClassId : %c"+message+"','color: blue;font-weight: bold', 'color: "+color+"',"+objmess+");"},catchLastErrorLog)}else console.log("%cClearClassId : %c"+message,"color: blue;font-weight: bold","color:"+color),chrome.tabs.executeScript({code:"console.log('%cClearClassId : %c"+message+"','color: blue;font-weight: bold','color: "+color+"');"},catchLastErrorLog)}}function catchLastErrorLog(){if(chrome.runtime.lastError){var obj=chrome.runtime.lastError,err=obj.messsage;console.log("%cClearClassId : %cError:","color: blue;font-weight: bold","color: red",obj)}}logEnabled=!0,chrome.webRequest.onCompleted.addListener(function(details){console.log(details),chrome.tabs.executeScript(details.tabId,{file:"deleteclasses.js"},()=>{chrome.runtime.lastError?Log('error: не загрузился скрипт "deleteclasses"',"error",chrome.runtime.lastError):(Log('скрипт "deleteclasses" загружен',"success"),Log("url (на что среагировал):"+details.url,"success"))})},{urls:["*://tv.yandex.ru/*period*"]},["responseHeaders"]),document.addEventListener("DOMContentLoaded",()=>{Log("есть DOMContentLoaded","info","test"),startBackground()});