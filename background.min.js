function startBackground(){getList("maskList",savedList=>{var urlList="";if(savedList){var arr=savedList.split(",");Log("Загрузили адреса прослушки:","info",arr);var urlfind="<all_urls>";savedList&&(urlfind=arr),"urlfind"==savedList&&(urlfind="<all_urls>"),chrome.webRequest.onCompleted.addListener(urlListener,{urls:urlfind},["responseHeaders"]),urlListener()}})}function getList(key,callback){chrome.storage.sync.get(key,items=>{callback(items[key])})}function loadListClasses(key,callback){chrome.storage.sync.get(key,items=>{callback(items[key])})}function urlListener(details){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){if(tabs[0]){var currenttab=tabs[0].url;details&&details.url!=currenttab||loadListClasses("classList",savedList=>{var classBuffer='var ClearClassBuffer = "'+savedList+'";';loadListClasses("idList",savedList=>{var idBuffer='var ClearIdBuffer = "'+savedList+'";';uploadElement(tabs[0],classBuffer+idBuffer)})})}})}function uploadElement(Tab,savedList){setTimeout(function(){chrome.tabs.executeScript(Tab.id,{code:savedList,allFrames:!0},()=>{chrome.runtime.lastError?Log("не загрузить списки","error",chrome.runtime.lastError):(Log("Списки загружены-3","success","инициатор: "+Tab.url),uploadScript(Tab))})},5e3)}function uploadScript(Tab){chrome.tabs.executeScript(Tab.id,{file:"deletetimer.js",allFrames:!0},()=>{chrome.runtime.lastError?Log('error: не загрузился скрипт "deletetimer"',"error",chrome.runtime.lastError):Log('скрипт "deletetimer" загружен',"success")})}function catchLastError(){chrome.runtime.lastError?Log("error: ","error",chrome.runtime.lastError):Log("отключить это","success")}function delListener(){chrome.webRequest.onCompleted.removeListener(urlListener),startBackground()}function Log(message,color,obj){if(0!=logEnabled){switch(color=color||"black"){case"success":case"ok":color="Green";break;case"info":color="DodgerBlue";break;case"error":case"err":color="Red";break;case"warning":color="Orange";break;default:color=color}if(obj){var objmess=JSON.stringify(obj);console.log("%cClearClassId : %c"+message,"color: blue;font-weight: bold","color:"+color,obj),chrome.tabs.executeScript({code:"console.log('%cClearClassId : %c"+message+"','color: blue;font-weight: bold', 'color: "+color+"',"+objmess+");",allFrames:!0},catchLastErrorLog)}else console.log("%cClearClassId : %c"+message,"color: blue;font-weight: bold","color:"+color),chrome.tabs.executeScript({code:"console.log('%cClearClassId : %c"+message+"','color: blue;font-weight: bold','color: "+color+"');",allFrames:!0},catchLastErrorLog)}}function catchLastErrorLog(){if(chrome.runtime.lastError){var obj=chrome.runtime.lastError,err=obj.messsage;console.log("%cClearClassId : %cError:","color: blue;font-weight: bold","color: red",obj)}}logEnabled=!0,chrome.webRequest.onCompleted.addListener(function(details){console.log(details),chrome.tabs.executeScript(details.tabId,{file:"deleteclasses.js",allFrames:!0},()=>{chrome.runtime.lastError?Log('error: не загрузился скрипт "deleteclasses"',"error",chrome.runtime.lastError):(Log('скрипт "deleteclasses" загружен',"success"),Log("url (на что среагировал):"+details.url,"success"))})},{urls:["*://tv.yandex.ru/*period*"]},["responseHeaders"]),document.addEventListener("DOMContentLoaded",()=>{Log("есть DOMContentLoaded","info","test"),startBackground()}),chrome.runtime.onConnect.addListener(function(externalPort){externalPort.onDisconnect.addListener(function(){console.log("Отключились от Popup.js  окно закрылось.")}),console.log("Есть связь с popup.js...")});